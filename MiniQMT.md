量化交易系统，基于迅投QMT交易API，实现了您需要的所有功能。系统有六个主要模块，各自负责不同功能，同时支持React前端界面交互。

## 系统架构

1. **核心模块**：
   - `config.py` - 集中管理所有配置参数
   - `logger.py` - 日志管理，包括日志自动清理
   - `main.py` - 系统主入口，负责初始化和管理各模块
   - `utils.py` - 工具函数集合

2. **数据处理**：
   - `data_manager.py` - 负责历史数据获取与存储
   - `indicator_calculator.py` - 计算各种技术指标（MACD、均线等）

3. **交易策略**：
   - `strategy.py` - 实现核心交易策略
   - `position_manager.py` - 持仓管理和监控
   - `trading_executor.py` - 交易执行和订单管理

4. **Web服务**：
   - `web_server.py` - 提供RESTful API接口供React前端调用

## 交易策略实现

系统严格遵循您提出的交易策略规则：

1. **分仓买入**
   - 每次买入固定金额（默认20000元）
   - 根据建仓成本价格比例（93%、86%等）设置补仓点位
   - 达到仓位上限（默认50000元）后停止买入
   - 总持仓成本损失超过9.5%时全仓止损

2. **动态止盈**
   - 实现浮盈比例与止盈位动态关联
   - 首次盈利达到5%时卖出半仓保证胜率
   - 余下仓位根据动态止盈位置卖出，盈利越多回调空间越大

3. **网格交易**
   - 对持仓个股进行自动网格交易
   - 可调整网格幅度和每格交易量

4. **自动日志管理**
   - 自动清理过期日志文件，不占用存储空间

## 系统特点

1. **模块化设计**：每个功能独立成模块，代码结构清晰
2. **参数可配置**：所有交易参数集中管理，易于调整
3. **RESTful API**：提供完整API供前端调用
4. **丰富的日志**：详细记录系统运行和交易过程
5. **错误处理**：完善的异常处理机制
6. **自动化运行**：支持无人值守的自动交易
7. **手动交易接口**：支持人工干预和操作

## 使用方法

1. 确保安装了必要的Python包：
   ```
   pip install pandas numpy talib flask flask-cors xtquant
   ```

2. 创建账户配置文件 `account_config.json`：
   ```json
   {
     "account_id": "你的交易账号",
     "account_type": "STOCK"
   }
   ```

3. 启动系统：
   ```
   python main.py
   ```

4. 访问Web界面（React前端）：
   ```
   http://localhost:5000
   ```

## 进一步开发

1. 可以增强交易策略，加入更多技术指标
2. 增加回测功能，评估策略效果
3. 优化网格交易算法
4. 添加风控模块，加强交易安全性
5. 增加数据分析和可视化功能

这个系统设计已经考虑了QMT API的特性，并实现了完整的交易生命周期管理，可以有效地支持量化交易策略的执行。